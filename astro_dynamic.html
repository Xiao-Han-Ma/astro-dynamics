<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro-Dynamics Command Center</title>
    <style>
        :root {
            --bg: #020508;
            --neon: #00d2ff;
            --glass: rgba(10, 25, 41, 0.95);
            --border: rgba(0, 210, 255, 0.3);
            --warn: #ff9f43;
        }

        body {
            margin: 0; font-family: 'JetBrains Mono', 'Segoe UI', monospace;
            background-color: var(--bg); color: #fff; overflow: hidden; display: flex; height: 100vh;
            hyphens: none;
        }

        #sidebar {
            width: 280px; background: #050a10; border-right: 1px solid var(--border);
            padding: 20px; z-index: 100; overflow-y: auto;
        }

        h1 { font-size: 1rem; color: var(--neon); letter-spacing: 2px; text-align: center; margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        .main-label { color: var(--neon); font-size: 0.85rem; margin: 20px 0 10px; border-left: 3px solid var(--neon); padding-left: 10px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .sub-menu { margin-left: 15px; display: flex; flex-direction: column; gap: 5px; }

        .nav-btn {
            display: block; width: 100%; padding: 8px; 
            background: transparent; border: 1px solid #1a2a3a;
            color: #b0c4de; cursor: pointer; text-align: left; font-size: 0.7rem;
            transition: 0.2s; border-radius: 3px;
        }
        .nav-btn:hover { border-color: var(--neon); color: #fff; }

        #system-container {
            flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: center;
            background-image: radial-gradient(circle at center, #1a2a3a 0%, #020508 100%);
            transition: margin-right 0.5s ease;
        }

        .orbit { position: absolute; border: 1px solid rgba(0, 210, 255, 0.08); border-radius: 50%; pointer-events: none; }
        #sun { width: 40px; height: 40px; background: #fff; border-radius: 50%; box-shadow: 0 0 40px #f1c40f; z-index: 10; }

        .p-node {
            position: absolute; display: flex; flex-direction: column; align-items: center; 
            transform: translate(-50%, -50%); z-index: 20;
        }
        .p-core { border-radius: 50%; box-shadow: 0 0 10px rgba(255,255,255,0.1); transition: all 0.5s ease; }
        .p-text { font-size: 9px; margin-top: 4px; color: var(--neon); font-weight: bold; transition: all 0.5s ease; }

        .highlight .p-core { transform: scale(2.5); box-shadow: 0 0 25px var(--neon); border: 2px solid #fff; }
        .highlight .p-text { font-size: 14px; color: #fff; text-shadow: 0 0 10px var(--neon); }

        #info-panel {
            position: absolute; top: 0; right: -32%; width: 30%; height: 100%;
            background: var(--glass); border-left: 2px solid var(--neon);
            padding: 30px; z-index: 1000; transition: right 0.5s ease;
            backdrop-filter: blur(15px); box-sizing: border-box; overflow-y: auto;
        }
        #info-panel.active { right: 0; }

        .info-h { font-size: 1.2rem; color: var(--neon); margin-bottom: 15px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .info-b { font-size: 0.85rem; line-height: 1.6; color: #ccd; margin-bottom: 20px; }
        
        #hud-container {
            width: 100%; height: 180px; background: #000; border: 1px solid var(--neon);
            border-radius: 4px; position: relative; margin-top: 15px; display: none;
        }
        #hud-label { position: absolute; top: 5px; left: 10px; font-size: 10px; color: var(--neon); z-index: 5; }
        #hud-canvas { width: 100%; height: 100%; display: block; }

        .opt-grid { display: grid; grid-template-columns: 1fr; gap: 8px; }
        .opt-btn { background: #0f172a; border: 1px solid var(--neon); color: var(--neon); padding: 8px; cursor: pointer; font-size: 0.7rem; border-radius: 2px; }
        .opt-btn:hover { background: var(--neon); color: #000; }

        .reset-all { margin-top: 25px; color: #ff4757; cursor: pointer; font-size: 0.7rem; border: 1px solid #ff4757; padding: 8px; width: 100%; background: none; text-transform: uppercase; }
    </style>
</head>
<body>

<div id="sidebar">
    <h1>ASTRO_DYNAMICS</h1>
    
    <div class="main-label" onclick="ui('cat_inf')">INFERIOR PLANETS</div>
    <div class="sub-menu">
        <button class="nav-btn" onclick="ui('inf_conj')">CONJUNCTION</button>
        <button class="nav-btn" onclick="ui('inf_elong')">GREATEST ELONGATION</button>
    </div>

    <div class="main-label" onclick="ui('cat_sup')">SUPERIOR PLANETS</div>
    <div class="sub-menu">
        <button class="nav-btn" onclick="ui('sup_conj')">CONJUNCTION</button>
        <button class="nav-btn" onclick="ui('sup_opp')">OPPOSITION</button>
        <button class="nav-btn" onclick="ui('sup_quad')">QUADRATURE / ELONGATION</button>
    </div>
    
    <div class="main-label" onclick="ui('retrograde')">RETROGRADE MOTION</div>
    <div class="main-label" onclick="ui('transit')">TRANSIT</div>

    <button class="reset-all" onclick="resetSystem()">MASTER_RESET</button>
</div>

<div id="system-container">
    <div id="sun"></div>
    <div class="orbit" id="o-mer" style="width: 80px; height: 80px;"></div>
    <div class="orbit" id="o-ven" style="width: 140px; height: 140px;"></div>
    <div class="orbit" id="o-ear" style="width: 220px; height: 220px;"></div>
    <div class="orbit" id="o-mar" style="width: 300px; height: 300px;"></div>
    <div class="orbit" id="o-jup" style="width: 380px; height: 380px;"></div>
    <div class="orbit" id="o-sat" style="width: 460px; height: 460px;"></div>
    <div class="orbit" id="o-ura" style="width: 540px; height: 540px;"></div>
    <div class="orbit" id="o-nep" style="width: 620px; height: 620px;"></div>
    <div class="orbit" id="o-plu" style="width: 700px; height: 700px;"></div>

    <div id="p-mercury" class="p-node"><div class="p-core" style="width:6px; height:6px; background:#95a5a6"></div><div class="p-text">MERCURY</div></div>
    <div id="p-venus" class="p-node"><div class="p-core" style="width:12px; height:12px; background:#e67e22"></div><div class="p-text">VENUS</div></div>
    <div id="p-earth" class="p-node"><div class="p-core" style="width:14px; height:14px; background:#3498db"></div><div class="p-text">EARTH</div></div>
    <div id="p-mars" class="p-node"><div class="p-core" style="width:10px; height:10px; background:#e74c3c"></div><div class="p-text">MARS</div></div>
    <div id="p-jupiter" class="p-node"><div class="p-core" style="width:20px; height:20px; background:#d39c7e"></div><div class="p-text">JUPITER</div></div>
    <div id="p-saturn" class="p-node"><div class="p-core" style="width:18px; height:18px; background:#f1c40f"></div><div class="p-text">SATURN</div></div>
    <div id="p-uranus" class="p-node"><div class="p-core" style="width:14px; height:14px; background:#a4d8e1"></div><div class="p-text">URANUS</div></div>
    <div id="p-neptune" class="p-node"><div class="p-core" style="width:14px; height:14px; background:#34495e"></div><div class="p-text">NEPTUNE</div></div>
    <div id="p-pluto" class="p-node"><div class="p-core" style="width:6px; height:6px; background:#7f8c8d"></div><div class="p-text">PLUTO</div></div>
</div>

<div id="info-panel">
    <h2 id="info-h">TERMINAL</h2>
    <div id="info-b" class="info-b">Awaiting instructions...</div>
    <div id="hud-container">
        <div id="hud-label">OBSERVATION_PERSPECTIVE</div>
        <canvas id="hud-canvas"></canvas>
    </div>
    <div id="opt-container" class="opt-grid"></div>
</div>

<script>
    const planets = {
        mercury: { d: 40, s: 4.15, g: 'inf', c: '#95a5a6' }, venus: { d: 70, s: 1.62, g: 'inf', c: '#e67e22' }, earth: { d: 110, s: 1.0, g: 'ear', c: '#3498db' },
        mars: { d: 150, s: 0.53, g: 'sup', c: '#e74c3c' }, jupiter: { d: 190, s: 0.08, g: 'sup', c: '#d39c7e' }, saturn: { d: 230, s: 0.034, g: 'sup', c: '#f1c40f' },
        uranus: { d: 270, s: 0.011, g: 'sup', c: '#a4d8e1' }, neptune: { d: 310, s: 0.006, g: 'sup', c: '#34495e' }, pluto: { d: 350, s: 0.004, g: 'sup', c: '#7f8c8d' }
    };

    let angles = { mercury:0, venus:0, earth:0, mars:0, jupiter:0, saturn:0, uranus:0, neptune:0, pluto:0 };
    let isLive = true;
    let mode = 'idle';
    let activeP = null; 
    let retroPath = [];
    let canvas = document.getElementById('hud-canvas');
    let ctx = canvas.getContext('2d');

    function setPos(p, deg) {
        const rad = deg * (Math.PI / 180);
        const el = document.getElementById('p-' + p);
        el.style.left = `calc(50% + ${Math.cos(rad) * planets[p].d}px)`;
        el.style.top = `calc(50% + ${Math.sin(rad) * planets[p].d}px)`;
    }

    function animate() {
        if (isLive) {
            Object.keys(planets).forEach(p => {
                angles[p] = (angles[p] + planets[p].s) % 360;
                setPos(p, angles[p]);
            });
        } else if (mode === 'retrograde' || mode === 'transit') {
            syncUpdate();
        }
        requestAnimationFrame(animate);
    }

    function syncUpdate() {
        angles.earth = (angles.earth + planets.earth.s) % 360;
        setPos('earth', angles.earth);
        ctx.fillStyle = '#000'; ctx.fillRect(0,0,300,180);

        if (mode === 'retrograde' && activeP) {
            angles[activeP] = (angles[activeP] + planets[activeP].s) % 360;
            setPos(activeP, angles[activeP]);
            let ex = Math.cos(angles.earth * Math.PI/180) * planets.earth.d;
            let ey = Math.sin(angles.earth * Math.PI/180) * planets.earth.d;
            let px = Math.cos(angles[activeP] * Math.PI/180) * planets[activeP].d;
            let py = Math.sin(angles[activeP] * Math.PI/180) * planets[activeP].d;
            let relAng = Math.atan2(py - ey, px - ex);
            
            const currentPoint = {x: 150 + Math.cos(relAng)*65, y: 90 + Math.sin(relAng)*35};
            retroPath.push(currentPoint);
            if(retroPath.length > 500) retroPath.shift();
            
            // 绘制轨迹线
            ctx.strokeStyle = planets[activeP].c; 
            ctx.lineWidth = 1;
            ctx.beginPath();
            retroPath.forEach((p,i) => { if(i===0) ctx.moveTo(p.x, p.y); else ctx.lineTo(p.x, p.y); });
            ctx.stroke();

            // 绘制行星球体 (新增部分)
            ctx.fillStyle = planets[activeP].c;
            ctx.shadowBlur = 10;
            ctx.shadowColor = planets[activeP].c;
            ctx.beginPath();
            ctx.arc(currentPoint.x, currentPoint.y, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0; // 重置阴影避免影响后续绘制

        } else if (mode === 'transit') {
            angles.venus = (angles.venus + planets.venus.s) % 360;
            setPos('venus', angles.venus);
            ctx.fillStyle = '#ffda00'; ctx.beginPath(); ctx.arc(150, 90, 40, 0, Math.PI*2); ctx.fill();
            let diff = ((angles.venus - angles.earth + 180) % 360) - 180;
            if(Math.abs(diff) < 15) {
                ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(150 + (diff*8), 90, 4, 0, Math.PI*2); ctx.fill();
            }
        }
    }

    function ui(type) {
        const h = document.getElementById('info-h');
        const b = document.getElementById('info-b');
        const hud = document.getElementById('hud-container');
        const opts = document.getElementById('opt-container');
        
        resetH();
        opts.innerHTML = '';
        hud.style.display = 'none';
        document.getElementById('info-panel').classList.add('active');
        document.getElementById('system-container').style.marginRight = "30%";

        if (type === 'cat_inf') {
            isLive = false; mode = 'static';
            h.innerText = "Inferior Planets";
            b.innerText = "Inferior planets are planets that orbit the Sun inside the Earth's orbit. These include Mercury and Venus. Because of their position, they exhibit phases like the Moon and can never reach opposition.";
            Object.keys(planets).forEach(p => { if(planets[p].g === 'inf') document.getElementById('p-'+p).classList.add('highlight'); });
        } else if (type === 'inf_conj') {
            isLive = false; mode = 'static'; isolate(['venus', 'earth']);
            h.innerText = "Conjunction";
            b.innerText = "Conjunction occurs when two celestial objects appear close to each other in the sky. For inferior planets, there are two types: Inferior and Superior.";
            addOpt('Inferior Conjunction', () => { 
                setPos('earth', 0); setPos('venus', 0); 
                b.innerText = "Inferior conjunction occurs when an inferior planet lies between the Earth and the Sun. The planet is nearly in a “new phase,” with its dark side mostly facing Earth.";
            });
            addOpt('Superior Conjunction', () => { 
                setPos('earth', 180); setPos('venus', 0); 
                b.innerText = "Superior Conjunction: The Earth, Sun, and the other planet are arranged in a straight line, with the Sun in the middle. Because the object is on the opposite side of the Sun, it cannot be viewed from Earth.";
            });
        } else if (type === 'inf_elong') {
            isLive = false; mode = 'static'; isolate(['venus', 'earth']);
            h.innerText = "Greatest Elongation";
            b.innerText = "Greatest elongation is the maximum angular distance between the Sun and an inferior planet. It represents the best time for viewing without solar interference.";
            addOpt('Greatest Eastern Elongation', () => { 
                setPos('earth', 0); setPos('venus', 45); 
                b.innerText = "Eastern Elongation: The planet is furthest east of the Sun. Visible as an 'Evening Star' in the western sky after sunset.";
            });
            addOpt('Greatest Western Elongation', () => { 
                setPos('earth', 0); setPos('venus', -45); 
                b.innerText = "Western Elongation: The planet is furthest west of the Sun. Visible as a 'Morning Star' in the eastern sky before sunrise.";
            });
        } else if (type === 'cat_sup') {
            isLive = false; mode = 'static';
            h.innerText = "Superior Planets";
            b.innerText = "Superior planets orbit the Sun outside the Earth's orbit. This group includes Mars, Jupiter, Saturn, Uranus, Neptune, and the dwarf planet Pluto. They can reach opposition and be observed throughout the night.";
            Object.keys(planets).forEach(p => { if(planets[p].g === 'sup') document.getElementById('p-'+p).classList.add('highlight'); });
        } else if (type === 'sup_conj') {
            isLive = false; mode = 'static'; isolate(['mars', 'earth']);
            h.innerText = "Conjunction";
            b.innerText = "For superior planets, conjunction occurs when the planet and the Sun appear together in the sky. The Earth, Sun, and planet are aligned in that order.";
            setPos('earth', 180); setPos('mars', 0);
        } else if (type === 'sup_opp') {
            isLive = false; mode = 'static'; isolate(['mars', 'earth']);
            h.innerText = "Opposition";
            b.innerText = "Opposition is when a superior planet is opposite the Sun in the Earth's sky. Earth is directly between the Sun and the planet. This is the optimal time for observation.";
            setPos('earth', 0); setPos('mars', 0);
        } else if (type === 'sup_quad') {
            isLive = false; mode = 'static'; isolate(['mars', 'earth']);
            h.innerText = "Quadrature";
            b.innerText = "Quadrature occurs when the direction to a superior planet is 90 degrees from the Earth-Sun line. The planet, Earth, and Sun form a right angle at the Earth vertex.";
            addOpt('Eastern Quadrature', () => { setPos('earth', 0); setPos('mars', 90); });
            addOpt('Western Quadrature', () => { setPos('earth', 0); setPos('mars', 270); });
        } else if (type === 'retrograde') {
            isLive = false; mode = 'retrograde'; activeP = null; retroPath = []; hud.style.display = 'block';
            h.innerText = "Retrograde Motion";
            b.innerText = "Generally, planets move from west to east (Prograde). Retrograde motion is the apparent backward (east to west) motion caused by Earth passing an outer planet or being passed by an inner planet.";
            addOpt('Observe Mars', () => { activeP = 'mars'; retroPath = []; b.innerText = "Earth is passing Mars. The line of sight changes relative to distant stars, creating a backward loop."; });
            addOpt('Observe Mercury', () => { activeP = 'mercury'; retroPath = []; b.innerText = "Mercury is passing Earth. Its faster orbital speed creates an apparent backward motion in our sky."; });
        } else if (type === 'transit') {
            isLive = false; mode = 'transit'; isolate(['venus', 'earth']); hud.style.display = 'block';
            h.innerText = "Transit";
            b.innerText = "A transit occurs when an inferior planet passes directly in front of the Solar disk. This rare event requires precise alignment of the orbital planes.";
        }
    }

    function addOpt(text, fn) {
        const btn = document.createElement('button'); btn.className = 'opt-btn'; btn.innerText = text; btn.onclick = fn;
        document.getElementById('opt-container').appendChild(btn);
    }

    function isolate(targets) {
        Object.keys(planets).forEach(k => {
            const vis = targets.includes(k) || k === 'earth';
            document.getElementById('p-'+k).style.display = vis ? 'flex' : 'none';
            const o = document.getElementById('o-'+k.slice(0,3)); if(o) o.style.display = vis ? 'block' : 'none';
        });
    }

    function resetH() {
        Object.keys(planets).forEach(p => {
            document.getElementById('p-'+p).classList.remove('highlight');
            document.getElementById('p-'+p).style.display = 'flex';
            const o = document.getElementById('o-'+p.slice(0,3)); if(o) o.style.display = 'block';
        });
    }

    function resetSystem() {
        isLive = true; mode = 'idle'; activeP = null;
        document.getElementById('info-panel').classList.remove('active');
        document.getElementById('system-container').style.marginRight = "0";
        document.getElementById('hud-container').style.display = 'none';
        resetH();
    }

    canvas.width = 300; canvas.height = 180;
    animate();
</script>

</body>
</html>